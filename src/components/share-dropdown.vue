<template>
  <div class="dropdown">
    <div data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <slot>
        <a class="nav-link text-gray-50 btn btn-sm btn-link">分享</a>
      </slot>
    </div>
    <div class="dropdown-menu" aria-labelledby="share-dropdown-menu">
      <a class="dropdown-item" target="_blank" :href="weibo"><span class="material-design-icon link-variant-icon"><svg t="1528816678350" class="material-design-icon__svg" viewBox="0 0 1260 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1944" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M1174.286235 110.614403A330.443026 330.443026 0 0 0 858.311759 7.467639a50.406563 50.406563 0 0 0-37.804922 58.34093 50.406563 50.406563 0 0 0 58.34093 37.804922 238.497721 238.497721 0 0 1 226.829535 72.342753 233.363719 233.363719 0 0 1 46.672744 233.36372 46.672744 46.672744 0 0 0 3.267092 37.804922 60.674567 60.674567 0 0 0 27.536919 24.269827 53.673655 53.673655 0 0 0 61.608021-30.804011 351.445761 351.445761 0 0 0-72.342753-329.509572z m0 0" p-id="1945"></path>
            <path d="M1026.800365 412.587056a40.13856 40.13856 0 0 0 51.340018-27.536919 158.220602 158.220602 0 0 0-34.537831-157.753874 167.088423 167.088423 0 0 0-154.486782-51.340019 37.338195 37.338195 0 0 0-30.804011 46.672744 37.338195 37.338195 0 0 0 46.672744 30.804011A79.343665 79.343665 0 0 1 980.127621 280.036463a82.144029 82.144029 0 0 1 17.268915 78.876937A46.672744 46.672744 0 0 0 1026.800365 412.587056z m-82.610757 78.876937c-17.268915-7.000912-30.804011-10.268004-20.536007-30.804011a136.751139 136.751139 0 0 0 0-126.949863c-41.072015-58.34093-154.486782-55.073838-280.036463 0 0 0-41.072015 17.268915-30.804011-13.535096 20.536007-65.341841 17.268915-116.68186-13.535096-147.485871-70.475843-69.075661-255.766636 2.800365-412.587056 161.020967-116.68186 119.948952-186.690975 243.631723-186.690975 353.779398 0 209.56062 267.90155 336.510483 528.802188 336.510483 343.511395 0 569.874202-199.292616 569.874202-357.04649 0-96.145852-82.610757-151.21969-154.486782-175.02279z m-415.38742 456.926162c-209.56062 20.536007-388.783956-75.609845-401.852325-209.56062s144.218778-264.634458 353.779399-285.170465 387.850501 75.609845 401.852324 209.56062-144.218778 264.16773-353.779398 285.170465z m0 0" p-id="1946"></path>
            <path d="M549.338195 556.805834a224.495898 224.495898 0 0 0-253.899726 109.680948A154.020055 154.020055 0 0 0 394.851413 886.782133a222.628988 222.628988 0 0 0 267.90155-113.414767 155.420237 155.420237 0 0 0-113.414768-216.561532z m-75.609845 230.096627a77.476755 77.476755 0 0 1-96.145852 30.804011 54.60711 54.60711 0 0 1-20.536008-82.610756 78.41021 78.41021 0 0 1 93.345488-30.804011 52.273473 52.273473 0 0 1 24.269827 82.610756z m0 0" p-id="1947"></path>
          </svg></span> 新浪微博</a>
      <a class="dropdown-item" target="_blank" :href="qq"><span class="material-design-icon link-variant-icon"><svg t="1531573585923" class="material-design-icon__svg" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="18559" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M936.194300839506 691.6934192494618c-5.891587367822223-94.26540047423211-70.69904970840491-170.8560375504593-106.04857520987652-212.09715041975304 5.891587367822223-11.783174735644446 17.674762103466666-79.53643140740742-29.457938133649378-126.66913164452346V349.981342854005c0-182.63921228610366-129.61492468116543-315.1999312984493-294.57937486380246-315.1999312984493s-294.57937615834066 132.5607190123457-294.57937615834066 315.1999312984493v2.9457943311802466c-47.132700237116055 47.132700237116055-35.349525501471604 114.885956908879-29.45793683911111 126.66913164452346-35.349525501471604 41.24111286929382-100.15698784205432 117.83174994552098-106.04857520987652 212.09715041975304 0 23.56634947128889 2.9457943311802466 58.91587497276049 14.728969066824689 76.59063707622718 14.728969066824689 20.62055643464691 55.97008193611851-2.9457943311802466 82.48222444404936-64.80746234058272 8.837381699002469 29.457938133649378 26.51214380246913 73.64484403958517 67.75325667176295 126.66913164452346-70.69904970840491 14.728969066824689-88.37381310640988 85.42801877522965-64.80746234058272 123.72333731334321 17.674762103466666 26.51214380246913 53.02428760493826 47.132700237116055 120.77754298216297 47.132700237116055 114.885956908879 0 167.9102445138173-32.40373117029136 191.4765952796444-53.02428760493826 5.891587367822223-5.891587367822223 11.783174735644446-5.891587367822223 20.620555140108642-5.891587367822223 8.837381699002469 0 14.728969066824689 2.9457943311802466 20.62055643464691 5.891587367822223 23.56634947128889 20.62055643464691 73.64484403958517 53.02428760493826 191.4765939851062 53.02428760493826 64.80746234058272 0 103.10278087869627-20.62055643464691 120.77754427670124-47.132700237116055 23.56634947128889-38.29531853811359 2.9457943311802466-106.04857520987652-64.80746234058272-123.72333731334321 41.24111286929382-55.97008193611851 58.91587497276049-100.15698784205432 67.75325667176295-126.66913164452346 29.457938133649378 61.86166930394074 67.75325667176295 85.42801877522965 82.48222444404936 64.80746234058272 5.891587367822223-17.674762103466666 11.783174735644446-53.02428760493826 8.837381699002469-76.59063707622718z m0 0" p-id="18560"></path>
          </svg></span> QQ 好友</a>
      <a class="dropdown-item" data-toggle="modal" data-target="#page-wechat-qrcode"><span class="material-design-icon link-variant-icon"><svg t="1531575816445" class="material-design-icon__svg" viewBox="0 0 1171 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1968" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M331.428571 263.428571q0-23.428571-14.285714-37.714286t-37.714286-14.285714q-24.571429 0-43.428571 14.571429t-18.857143 37.428571q0 22.285714 18.857143 36.857143t43.428571 14.571429q23.428571 0 37.714286-14t14.285714-37.428571zm424.571429 289.714286q0-16-14.571429-28.571429t-37.428571-12.571429q-15.428571 0-28.285714 12.857143t-12.857143 28.285714q0 16 12.857143 28.857143t28.285714 12.857143q22.857143 0 37.428571-12.571429t14.571429-29.142857zm-134.857143-289.714286q0-23.428571-14-37.714286t-37.428571-14.285714q-24.571429 0-43.428571 14.571429t-18.857143 37.428571q0 22.285714 18.857143 36.857143t43.428571 14.571429q23.428571 0 37.428571-14t14-37.428571zm362.857143 289.714286q0-16-14.857143-28.571429t-37.142857-12.571429q-15.428571 0-28.285714 12.857143t-12.857143 28.285714q0 16 12.857143 28.857143t28.285714 12.857143q22.285714 0 37.142857-12.571429t14.857143-29.142857zm-152-226.857143q-17.714286-2.285714-40-2.285714-96.571429 0-177.714286 44t-127.714286 119.142857-46.571429 164.285714q0 44.571429 13.142857 86.857143-20 1.714286-38.857143 1.714286-14.857143 0-28.571429-0.857143t-31.428571-3.714286-25.428571-4-31.142857-6-28.571429-6l-144.571429 72.571429 41.142857-124.571429q-165.714286-116-165.714286-280 0-96.571429 55.714286-177.714286t150.857143-127.714286 207.714286-46.571429q100.571429 0 190 37.714286t149.714286 104.285714 78 148.857143zm338.285714 320.571429q0 66.857143-39.142857 127.714286t-106 110.571429l31.428571 103.428571-113.714286-62.285714q-85.714286 21.142857-124.571429 21.142857-96.571429 0-177.714286-40.285714t-127.714286-109.428571-46.571429-150.857143 46.571429-150.857143 127.714286-109.428571 177.714286-40.285714q92 0 173.142857 40.285714t130 109.714286 48.857143 150.571429z" p-id="1969"></path>
          </svg></span> 微信扫码</a>
      <a class="dropdown-item" target="_blank" :href="qzone"><span class="material-design-icon link-variant-icon"><svg t="1531573585923" class="material-design-icon__svg" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="18559" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M757.116343 440.1536 457.245257 655.263086c0 0 120.347429 17.856 301.853257 15.786057l-8.259657-35.5712 258.618514-224.067657c4.754286-4.1216 6.577371-10.680686 4.629943-16.661943-1.9456-5.981257-7.277714-10.225371-13.540571-10.750171L659.604114 354.724571 526.4 39.506286c-2.437486-5.787429-8.120686-9.557943-14.4-9.557943s-11.960686 3.770514-14.398171 9.557943L364.397714 354.724571 23.451429 383.996343c-6.261029 0.526629-11.593143 4.768914-13.538743 10.750171-1.947429 5.981257-0.122514 12.540343 4.629943 16.661943l258.620343 224.067657L195.642514 968.813714c-1.4208 6.101943 0.9472 12.485486 6.032457 16.2048 5.103543 3.646171 11.8912 3.927771 17.2928 0.700343L512 809.003886l293.0304 176.7168c2.5088 1.545143 5.297371 2.247314 8.085943 2.247314 3.243886 0 6.473143-0.981943 9.206857-2.945829 5.087086-3.719314 7.455086-10.102857 6.034286-16.2048l-61.295543-263.6032c26.289371-13.2224 55.2448-35.602286 55.2448-35.602286s-114.753829 56.053029-526.729143 28.677486l298.574629-216.407771c0 0-11.733943-18.256457-385.914514-31.286857C183.191771 449.713371 513.296457 387.995429 757.116343 440.1536z" p-id="13675"></path>
          </svg></span> QQ 空间</a>
      <a class="dropdown-item copy-link" href="#" :data-clipboard-text="url" title="复制链接">
        <link-variant title="复制链接" /> 复制链接</a>
    </div>
  </div>
</template>

<script>
import LinkVariant from '$icons/LinkVariant'
import ClipboardJS from 'clipboard'

export default {
  name: 'share-dropdown',
  components: { LinkVariant },
  data () {
    return {
      url: encodeURI(window.location.href),
      title: encodeURIComponent(window.document.title),
      description: ''
    }
  },
  computed: {
    weibo () {
      return `https://service.weibo.com/share/share.php?url=${this.url}&title=${
        this.title
      }&pic=&appkey=`
    },
    qq () {
      return `http://connect.qq.com/widget/shareqq/index.html?url=${
        this.url
      }&title=${this.title}&source=${window.location.host}&desc=${
        this.description
      }`
    },
    qzone () {
      return `http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=${
        this.url
      }&summary=${this.title}&site=${window.location.host}`
    }
  },
  methods: {
    getDescription () {
      let d = document.querySelector('[name="description"]')
      if (d) {
        return encodeURIComponent(d.getAttribute('content'))
      }

      return encodeURIComponent(
        document
          .querySelector('.markdown-body')
          .textContent.substr(0, 40)
          .trim()
          .replace(new RegExp(/\n/, 'g'), '')
      )
    }
  },
  mounted () {
    new ClipboardJS('.copy-link')

    setTimeout(() => {
      this.description = this.getDescription()
    }, 1000)
  }
}
</script>

<style lang="scss" scoped>
.dropdown-toggle::after {
  display: none;
}
</style>
